
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FastFFT &#8212; FastFFT</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="testfile.html" />
    <link rel="prev" title="Welcome to your source for info about FastFFT" href="../../intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      <h1 class="site-logo" id="site-title">FastFFT</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to your source for info about FastFFT
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Manuscript
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="current reference internal" href="#">
   FastFFT
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Appendix
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../_appendix.html">
   Supress warnings - not intended for readers
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="simple">
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/_docs/MS/intro.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/bHimes/FastFFT"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/bHimes/FastFFT/issues/new?title=Issue%20on%20page%20%2F_docs/MS/intro.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#abstract">
   Abstract
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-discrete-fourier-trasnform">
     The discrete Fourier Trasnform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-fast-discrete-fourier-transform">
     the fast (discrete) Fourier Transform
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exploiting-zero-values">
     exploiting zero values
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#theory">
   Theory
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-dft-and-fft">
     The DFT and FFT
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary-of-gpu-memory-hierarchy-as-it-pertains-to-this-work">
     Summary of GPU memory hierarchy as it pertains to this work
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#graphic-to-illustrate-how-the-implicit-transpose-and-real-space-shifting-reduces-memory-access-for-forward-padding">
     Graphic to illustrate how the implicit transpose and real-space shifting reduces memory access for forward padding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maths-for-further-reduced-memory-access-and-computation-using-transform-decomposition-on-sparse-inputs">
     Maths for further reduced memory access and computation using transform decomposition on sparse inputs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#maths-for-partial-outputs">
     Maths for partial outputs
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id5">
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#results">
   Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basic-performance">
     Basic performance
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comparing-2d-ffts-using-cufftdx-w-o-reordering">
       Comparing 2D FFTs using cufftdx w/o reordering
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#table-1-fft-ifft-pairs">
         Table 1: FFT/iFFT pairs
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#comparing-2d-fft-based-convolution">
       Comparing 2D FFT based convolution
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#table-2-zero-padded-convolution-of-4096-pixel-sq-image">
         Table 2: zero padded convolution of 4096 pixel sq. image
        </a>
       </li>
       <li class="toc-h5 nav-item toc-entry">
        <a class="reference internal nav-link" href="#table-3-zero-padded-convolution-of-input-size-top-row-where-only-bottom-row-pixel-sq-is-needed-for-output">
         Table 3: zero padded convolution of input size (top row), where only (bottom row) pixel sq. is needed for output
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#input-movies-are-sparse-speed-up">
       Input movies are sparse (speed-up)
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#movies-have-a-predictable-shift-range">
       Movies have a predictable shift range
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#d-template-matching">
       2D template matching
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       3D template matching
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#subtomogram-averaging">
       Subtomogram averaging
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#discussion">
   Discussion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="fastfft">
<h1>FastFFT<a class="headerlink" href="#fastfft" title="Permalink to this headline">¬∂</a></h1>
<hr class="docutils" />
<div class="section" id="abstract">
<span id="ms-label"></span><h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this headline">¬∂</a></h2>
<p>The Fast Fourier transform is one of the most widely used and heavily optimized algorithms in digital signal processing. cryo-EM makes heavy use of the FFT as it can accelerate convolution operations used for image alignment, and also in reconstruction algorithms that operate most accurately in Fourier space. FFT libraries like FFTW and cuFFT provide routines for highly-optimized general purpose multi-dimensional FFTs; however, they overlook several use-cases where only a subset of the input or output points are required. We show here algorithms based on transform decomposition are well suited to the memory hierarchy on moden GPUs, and can be implemented using the cufftdx header library to accelerate several important algorithms by factors of 3-10x over Nvidia‚Äôs cuFFT library. These include movie-frame alignment, image resampling via Fourier cropping, 2d and 3d template matching, and subtomogram averaging and alignment.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¬∂</a></h2>
<p>The Discrete Fourier Transform (DFT) and linear filtering, <em>e.g.</em> convolution, are among the most common operations in digital signal processing. It is assumed that the reader has basic familiarity with Fourier Analysis and it‚Äôs applications in their respective fields; we will focus here on digital image processing for convenience. For a detailed introduction to the reader is referred to the free book by Smith <span id="id1">[<a class="reference internal" href="#id17">Smith, 2008</a>]</span>.</p>
<div class="section" id="the-discrete-fourier-trasnform">
<h3>The discrete Fourier Trasnform<a class="headerlink" href="#the-discrete-fourier-trasnform" title="Permalink to this headline">¬∂</a></h3>
<p>The discrete Fourier Transform (DFT) extends the operation of the Fourier Transform to a band-limited sequence of evenly spaced samples of a continous function. In one dimension, it is defined for a sequence of N samples <span class="math notranslate nohighlight">\(x(n)\)</span> as:</p>
<div class="math notranslate nohighlight" id="equation-dft-equation">
<span class="eqno">(1)<a class="headerlink" href="#equation-dft-equation" title="Permalink to this equation">¬∂</a></span>\[X(k) = \sum_{n=0}^{N-1} x(n) \exp\left( -2\pi i k n \right) \]</div>
<ul class="simple">
<li><p>‚ö†Ô∏è TODO: list properties (And brief example with a few citations, preferably specific to cryo-EM where each is capitalized on.)</p>
<ul>
<li><p>linearity</p></li>
<li><p>Parsevals</p></li>
<li><p>Convolution theorem</p></li>
<li><p>sinc interpolation</p></li>
<li><p>Fourier Slice theorem</p></li>
<li></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-fast-discrete-fourier-transform">
<h3>the fast (discrete) Fourier Transform<a class="headerlink" href="#the-fast-discrete-fourier-transform" title="Permalink to this headline">¬∂</a></h3>
<p>In looking at [‚ö†Ô∏è DFT equation above] it is clear that the DFT requires <span class="math notranslate nohighlight">\( O(N^2) \)</span>
complex exponential function evaluations, multiplications, and additions. The fast Fourier Transform (FFT) reduces the compuational complexity to <span class="math notranslate nohighlight">\( O(Nlog_2{N}) \)</span>
with the most efficient algorithm, the split-radix FFT requiring just <span class="math notranslate nohighlight">\( 4Nlog_2{N} - 6N  \)</span>. The Cooley-Tukey algorithm <span id="id2">[<a class="reference internal" href="#id16">Cooley and Tukey, 1965</a>]</span> was published little more than a decade after the first digitial computers became available. As is often the case in science, their discovery was really a re-discovery; the divide and conquer approach that underpins the FFT was already known to Gauss as early as 1805, predating Fourier‚Äôs work itself! <span id="id3">[<a class="reference internal" href="#id15">Heideman and Burrus, 1985</a>]</span></p>
<blockquote class="epigraph">
<div><p>This story of the FFT can be used to give one incentive to investigate not
only new and novel approaches, but to occasionally look over old papers and see the variety of tricks and clever ideas which were used when computing was, by itself, a laborious chore which gave clever people great incentive to develop efficient methods. Perhaps among the ideas discarded before the days of electronic computers, we may find more seeds of new
algorithms.</p>
<p class="attribution">‚ÄîJames W. Cooley <span id="id4">[<a class="reference internal" href="#id11">Cooley, 1987</a>]</span></p>
</div></blockquote>
<p>This present work itself follows from this same spirit of re-discovery; presently with respect to ideas discarded before the days of efficient graphics processing units (GPUs), rather than electronic computers on a whole.</p>
<p>‚ö†Ô∏è Segue to include notes from FFTW - before last PP, something something FFTW is an example of dev since then - as those authors note, pruning something something, note on arithmetic vs caches (cite actual FFTW paper) something something.</p>
</div>
<div class="section" id="exploiting-zero-values">
<h3>exploiting zero values<a class="headerlink" href="#exploiting-zero-values" title="Permalink to this headline">¬∂</a></h3>
<ul class="simple">
<li><p>Concept, reduce ops, but especially i/o</p></li>
<li><p>Mention pruning</p></li>
<li><p>Introduce transform decomposition (Sorensen)</p></li>
<li><p>Pictorial explanation for the major benefactors, also list estimate of ops.</p>
<ul>
<li><p>Movie alignment</p></li>
<li><p>2D TM</p></li>
<li><p>3D TM</p></li>
<li><p>Subtomogram averaging</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="theory">
<h2>Theory<a class="headerlink" href="#theory" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="the-dft-and-fft">
<h3>The DFT and FFT<a class="headerlink" href="#the-dft-and-fft" title="Permalink to this headline">¬∂</a></h3>
<p>Fast Fourier Transform (FFT) is a mathematical operation that transforms a function <span class="math notranslate nohighlight">\( X(n) \)</span> from the real-valued plane into the complex-valued plane. The function <span class="math notranslate nohighlight">\( f(x) \)</span> is a function of <span class="math notranslate nohighlight">\( x \)</span> and is often a function of the real-valued signal <span class="math notranslate nohighlight">\( x \)</span> or a function of the complex-valued signal <span class="math notranslate nohighlight">\( x + i\cdot y \)</span>. The FFT is an optimized algorithm for copying the discrete Fourier transform (DFT) defined as:</p>
<p>( I think this paragraph is probably belonging in the introduction )</p>
<p>The FFT is useful in image analysis as it can help to isolate repetitive features of a given size. It is also useful in signal processing as it can be used to perform convolution operations. Multidimensional FFTs are fully seperable, such that in the simpliest case, FFTs in higher dimensions are composed of a sequence of 1D FFTs. For example, in two dimensions, the FFT of a 2D image is composed of the 1D FFTs of the rows and columns. A naive implementation is compuatationally ineffecient due to the strided memory access pattern‚ö†Ô∏è. One solution is to transpose the data after the FFT and then transpose the result back ‚ö†Ô∏è. This requires extra trips to and from main memory. Another solution is to decompose the 2D transform using vector-radix FFTs ‚ö†Ô∏è.</p>
</div>
<div class="section" id="summary-of-gpu-memory-hierarchy-as-it-pertains-to-this-work">
<h3>Summary of GPU memory hierarchy as it pertains to this work<a class="headerlink" href="#summary-of-gpu-memory-hierarchy-as-it-pertains-to-this-work" title="Permalink to this headline">¬∂</a></h3>
<p>Working with a subset of input or output points for an FFT exposes several possibilites to exploit fine grained control of the memory hierarchy available on modern Nvidia GPUs.</p>
</div>
<div class="section" id="graphic-to-illustrate-how-the-implicit-transpose-and-real-space-shifting-reduces-memory-access-for-forward-padding">
<h3>Graphic to illustrate how the implicit transpose and real-space shifting reduces memory access for forward padding<a class="headerlink" href="#graphic-to-illustrate-how-the-implicit-transpose-and-real-space-shifting-reduces-memory-access-for-forward-padding" title="Permalink to this headline">¬∂</a></h3>
</div>
<div class="section" id="maths-for-further-reduced-memory-access-and-computation-using-transform-decomposition-on-sparse-inputs">
<h3>Maths for further reduced memory access and computation using transform decomposition on sparse inputs<a class="headerlink" href="#maths-for-further-reduced-memory-access-and-computation-using-transform-decomposition-on-sparse-inputs" title="Permalink to this headline">¬∂</a></h3>
</div>
<div class="section" id="maths-for-partial-outputs">
<h3>Maths for partial outputs<a class="headerlink" href="#maths-for-partial-outputs" title="Permalink to this headline">¬∂</a></h3>
</div>
<div class="section" id="id5">
<h3><a class="headerlink" href="#id5" title="Permalink to this headline">¬∂</a></h3>
</div>
</div>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¬∂</a></h2>
<div class="section" id="basic-performance">
<h3>Basic performance<a class="headerlink" href="#basic-performance" title="Permalink to this headline">¬∂</a></h3>
<div class="section" id="comparing-2d-ffts-using-cufftdx-w-o-reordering">
<h4>Comparing 2D FFTs using cufftdx w/o reordering<a class="headerlink" href="#comparing-2d-ffts-using-cufftdx-w-o-reordering" title="Permalink to this headline">¬∂</a></h4>
<p>By design, the cufft library from Nvidia returns an FFT in the natural order [TODO check term] which requires two transpose operations, which in many cases seem to be optimized to reduce global memory access via vector-radix transforms. This means that the numbers we compare here are not quite apples to apples, as the result from FastFFT is transposed in memory in the Fourier domain.</p>
<div class="section" id="table-1-fft-ifft-pairs">
<h5>Table 1: FFT/iFFT pairs<a class="headerlink" href="#table-1-fft-ifft-pairs" title="Permalink to this headline">¬∂</a></h5>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>2D square size</p></th>
<th class="head"><p>cufft/FastFFT runtime (10k iterations)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>64</p></td>
<td><p>1.23</p></td>
</tr>
<tr class="row-odd"><td><p>128</p></td>
<td><p>1.36</p></td>
</tr>
<tr class="row-even"><td><p>256</p></td>
<td><p>1.22</p></td>
</tr>
<tr class="row-odd"><td><p>512</p></td>
<td><p>0.92</p></td>
</tr>
<tr class="row-even"><td><p>1024</p></td>
<td><p>0.69</p></td>
</tr>
<tr class="row-odd"><td><p>2048</p></td>
<td><p>0.95</p></td>
</tr>
<tr class="row-even"><td><p>4096</p></td>
<td><p>1.10</p></td>
</tr>
</tbody>
</table>
<p>üçç None of the kernels are even remotely optimized at this point, they have only been assembled and tested to pass expected behavior for FFTs of constant functions, unit impulse functions, and basic convolution ops.</p>
<p>üçç The relative decrease in performance on re-org seems to  be partially due to less optimization in the kernels at compile time (kernels themselves did not change) and given the trend with size, mainly due to overhead in launch? The question is whether the trade off in ease in reading the code is worth it.</p>
<p>:plus: Add in results for using the decomposition method for non-powers of two, more computation but fewer local memory accesses vs Bluesteins.</p>
</div>
</div>
<div class="section" id="comparing-2d-fft-based-convolution">
<h4>Comparing 2D FFT based convolution<a class="headerlink" href="#comparing-2d-fft-based-convolution" title="Permalink to this headline">¬∂</a></h4>
<div class="section" id="table-2-zero-padded-convolution-of-4096-pixel-sq-image">
<h5>Table 2: zero padded convolution of 4096 pixel sq. image<a class="headerlink" href="#table-2-zero-padded-convolution-of-4096-pixel-sq-image" title="Permalink to this headline">¬∂</a></h5>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>2D input</p></th>
<th class="head"><p>2x size</p></th>
<th class="head"><p>4096</p></th>
<th class="head"><p>cufft/FastFFT runtime (10k iterations)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>32</p></td>
<td><p>2.32</p></td>
<td><p>2.46</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>64</p></td>
<td><p>2.54</p></td>
<td><p>2.59</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>128</p></td>
<td><p>2.25</p></td>
<td><p>2.52</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>256</p></td>
<td><p>1.57</p></td>
<td><p>2.45</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>512</p></td>
<td><p>1.33</p></td>
<td><p>2.46</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>1024</p></td>
<td><p>1.85</p></td>
<td><p>2.25</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>2048</p></td>
<td><p>1.95</p></td>
<td><p>1.95</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="table-3-zero-padded-convolution-of-input-size-top-row-where-only-bottom-row-pixel-sq-is-needed-for-output">
<h5>Table 3: zero padded convolution of input size (top row), where only (bottom row) pixel sq. is needed for output<a class="headerlink" href="#table-3-zero-padded-convolution-of-input-size-top-row-where-only-bottom-row-pixel-sq-is-needed-for-output" title="Permalink to this headline">¬∂</a></h5>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p></p></th>
<th class="head"><p>32</p></th>
<th class="head"><p>64</p></th>
<th class="head"><p>128</p></th>
<th class="head"><p>256</p></th>
<th class="head"><p>512</p></th>
<th class="head"><p>1024</p></th>
<th class="head"><p>2048</p></th>
<th class="head"><p>4096</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>16</p></td>
<td><p>1.8</p></td>
<td><p>1.75</p></td>
<td><p>1.88</p></td>
<td><p>1.75</p></td>
<td><p>1.36</p></td>
<td><p>0.93</p></td>
<td><p>1.7</p></td>
<td><p>2.01</p></td>
</tr>
<tr class="row-odd"><td><p>32</p></td>
<td><p></p></td>
<td><p>1.56</p></td>
<td><p>1.87</p></td>
<td><p>1.72</p></td>
<td><p>1.37</p></td>
<td><p>0.92</p></td>
<td><p>1.69</p></td>
<td><p>2.00</p></td>
</tr>
<tr class="row-even"><td><p>64</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>1.82</p></td>
<td><p>1.69</p></td>
<td><p>1.34</p></td>
<td><p>0.91</p></td>
<td><p>1.68</p></td>
<td><p>1.99</p></td>
</tr>
<tr class="row-odd"><td><p>128</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>1.65</p></td>
<td><p>1.31</p></td>
<td><p>0.89</p></td>
<td><p>1.64</p></td>
<td><p>1.95</p></td>
</tr>
<tr class="row-even"><td><p>256</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>1.24</p></td>
<td><p>0.84</p></td>
<td><p>1.57</p></td>
<td><p>1.91</p></td>
</tr>
<tr class="row-odd"><td><p>512</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>0.98</p></td>
<td><p>1.48</p></td>
<td><p>1.84</p></td>
</tr>
<tr class="row-even"><td><p>1024</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>1.32</p></td>
<td><p>1.69</p></td>
</tr>
<tr class="row-odd"><td><p>2048</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p>1.48</p></td>
</tr>
</tbody>
</table>
<p>üçç None of the kernels are even remotely optimized at this point, they have only been assembled and tested to pass expected behavior for FFTs of constant functions, unit impulse functions, and basic convolution ops.</p>
<p>üçç See note on previous table. The relative perf hit is not nearly as dramatic as in the previous table; however it is still about 10% which is a tough pill to swallow.</p>
<ul>
<li><p>Movie alignment expense (Pre/post process and alignment percentages.)</p>
<p>:soon:</p>
</li>
</ul>
</div>
</div>
<div class="section" id="input-movies-are-sparse-speed-up">
<h4>Input movies are sparse (speed-up)<a class="headerlink" href="#input-movies-are-sparse-speed-up" title="Permalink to this headline">¬∂</a></h4>
<p>The largest speed up for a subset of input points is had when those non-zero points are contiguous, however, the reduced memory transfers even for non-contiguous values is still dope. The low-exposure imaging conditions used in HR-cryoEM generally results in ~10% non-zeros. ‚ö†Ô∏è Something about EER format.</p>
</div>
<div class="section" id="movies-have-a-predictable-shift-range">
<h4>Movies have a predictable shift range<a class="headerlink" href="#movies-have-a-predictable-shift-range" title="Permalink to this headline">¬∂</a></h4>
<p>The shifts between subsequent exposures in cryoEM movie frames is relatively small, on the order of tens of Angstroms (usually 5-20 pixels) in early frames, down to angstroms (0.5-2 pixels) in later frames. Using this prior knowledge, we can use only a limited subset of the output pixels, dramatically decreasing runtime in the translational search.</p>
</div>
<div class="section" id="d-template-matching">
<h4>2D template matching<a class="headerlink" href="#d-template-matching" title="Permalink to this headline">¬∂</a></h4>
<p>Typical use case is to search an image of size ~ 4K x 4K over ~ 2 million cross correlations, with a template that is ~ 384-512 pixels square. Each of these searches requires padding the template to the size of the search image, taking the FFT, conj mul and iFFT. We currently optimize this by transforming the search image in single-precision, storing in FP16 to improve reads. Convert from FP16 and conj mul in single precision using cuFFT callbacks on the load, convert back to FP16 on the store with a store call back. Here we improve on this by ‚Ä¶</p>
</div>
<div class="section" id="id6">
<h4>3D template matching<a class="headerlink" href="#id6" title="Permalink to this headline">¬∂</a></h4>
<p>Pad something like 128 ‚Äì&gt; 512^3 over X chunks. Far fewer orientations than 2DTM (number).</p>
</div>
<div class="section" id="subtomogram-averaging">
<h4>Subtomogram averaging<a class="headerlink" href="#subtomogram-averaging" title="Permalink to this headline">¬∂</a></h4>
<p>While the total zero padding is less (1.5x to 2x) than 3D template matching, there are typically many more cross-correlations in a given project. Like movie alignment, subtomogram averaging also benefits in both directions, as the translational search allows for a strictly limited set of output points to find the shifts. These combined lead to X speedup.</p>
</div>
</div>
</div>
<div class="section" id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Permalink to this headline">¬∂</a></h2>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¬∂</a></h2>
<p>The FFT has many applications in signal and image processing, such that improving its efficiency for even a subset of problems can still have a broad impact. Here we demonstrate how fairly old algorithmic ideas, transform decomposition, can be mapped to new computational hardware to achieve substantial computational acceleration. The use cases presented in the results have typical run-times on the order of hours to days, such that even fractional speed ups, much less 2-5 fold acceleration are substantial. Gimme some oreos now.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¬∂</a></h2>
<p id="id7"><dl class="citation">
<dt class="label" id="id8"><span class="brackets">1</span></dt>
<dd><p>H.V. Sorensen and C.S. Burrus. Efficient computation of the DFT with only a subset of input or output points. <em>IEEE Transactions on Signal Processing</em>, 41(3):1184‚Äì1200, March 1993. URL: <a class="reference external" href="http://ieeexplore.ieee.org/document/205723/">http://ieeexplore.ieee.org/document/205723/</a> (visited on 2021-03-18), <a class="reference external" href="https://doi.org/10.1109/78.205723">doi:10.1109/78.205723</a>.</p>
</dd>
<dt class="label" id="id17"><span class="brackets"><a class="fn-backref" href="#id1">2</a></span></dt>
<dd><p>Julios O.¬†III Smith. <em>Mathematics of the Discrete Fourier Transform (DFT) With Audio Applications</em>. W3k Publishing, 2 edition, May 2008. ISBN 978-0-9745607-4-8. URL: <a class="reference external" href="https://www.dsprelated.com/freebooks/mdft/">https://www.dsprelated.com/freebooks/mdft/</a> (visited on 2021-09-09).</p>
</dd>
<dt class="label" id="id16"><span class="brackets"><a class="fn-backref" href="#id2">3</a></span></dt>
<dd><p>James¬†W. Cooley and John¬†W. Tukey. An algorithm for the machine calculation of complex Fourier series. <em>Mathematics of Computation</em>, 19(90):297‚Äì297, May 1965. URL: <a class="reference external" href="http://www.ams.org/jourcgi/jour-getitem?pii=S0025-5718-1965-0178586-1">http://www.ams.org/jourcgi/jour-getitem?pii=S0025-5718-1965-0178586-1</a> (visited on 2021-09-09), <a class="reference external" href="https://doi.org/10.1090/S0025-5718-1965-0178586-1">doi:10.1090/S0025-5718-1965-0178586-1</a>.</p>
</dd>
<dt class="label" id="id15"><span class="brackets"><a class="fn-backref" href="#id3">4</a></span></dt>
<dd><p>Michael¬†T Heideman and C¬†Sidney Burrus. Gauss and the history of the fast Fourier transform. <em>Archive for History of Exact Sciences</em>, 34(3):265‚Äì277, February 1985. <a class="reference external" href="https://doi.org/DOI:10.1007/BF00348431">doi:DOI:10.1007/BF00348431</a>.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id4">5</a></span></dt>
<dd><p>James¬†W. Cooley. The re-discovery of the fast Fourier transform algorithm. <em>Mikrochimica Acta</em>, 93(1-6):33‚Äì45, January 1987. URL: <a class="reference external" href="http://link.springer.com/10.1007/BF01201681">http://link.springer.com/10.1007/BF01201681</a> (visited on 2021-09-09), <a class="reference external" href="https://doi.org/10.1007/BF01201681">doi:10.1007/BF01201681</a>.</p>
</dd>
</dl>
</p>
</div>
<div class="toctree-wrapper compound">
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./_docs/MS"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="../../intro.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Welcome to your source for info about <em>Fast</em>FFT</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="testfile.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">&lt;no title&gt;</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By The *Fast*FFT Community<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>